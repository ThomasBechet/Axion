#version 420 core

layout(location = 0) out vec3 out_color;

layout(binding = 0) uniform sampler2D gbuffer_albedo;
layout(binding = 1) uniform sampler2D gbuffer_normal;
layout(binding = 2) uniform sampler2D gbuffer_position;
layout(binding = 3) uniform sampler2D gbuffer_depth;

in vec2 UV;

#define USE_POINTLIGHT_UNIFORM_BLOCK 1 
#if USE_POINTLIGHT_UNIFORM_BLOCK

	#define POINTLIGHT_MAX_NUMBER 50
	#define POINTLIGHT_BINDING_POINT 2

	struct PointLight
	{
		vec4 color;
		float radius;
		float intensity;
	};
	layout(std140, binding = POINTLIGHT_BINDING_POINT) uniform PointLights
	{
		PointLight point_lights[POINTLIGHT_MAX_NUMBER];	
	};

	uniform uint pointlight_index;
	uniform vec3 pointlight_position;
#endif

void main()
{
	vec3 normal = texture2D(gbuffer_normal, UV).xyz;
	vec4 colorDiffuse = vec4(texture2D(gbuffer_albedo, UV).xyz, 1.0f);
	vec3 fragPos = texture2D(gbuffer_position, UV).xyz;

	vec3 lightPos = vec3(4.0f, 4.0f, 0.0f);
	float ambientStrength = 0.0f;

	vec3 n = normalize(normal);
	vec3 l = normalize(lightPos - fragPos);

	float diffuse = max(dot(n, l), 0.0f);
	vec4 ambient = colorDiffuse * ambientStrength;

	vec4 color = (diffuse * colorDiffuse) + ambient;
	out_color = color.xyz;
}